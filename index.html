<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT Web Client</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            text-align: center;
            padding: 50px;
        }
        #messages {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            width: 50%;
            margin-left: auto;
            margin-right: auto;
            background-color: white;
        }
        input, button {
            padding: 10px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>MQTT Web Client</h1>
    
    <!-- Input Broker URL -->
    <input id="broker" type="text" placeholder="Broker URL (e.g. ws://broker.hivemq.com:8000/mqtt)" style="width: 300px;">
    <button onclick="connectMQTT()">Connect</button>
    <br>

    <!-- Input untuk topik dan pesan -->
    <input id="topic" type="text" placeholder="Topic" style="width: 300px;">
    <input id="message" type="text" placeholder="Message" style="width: 300px;">
    <button onclick="publishMessage()">Publish</button>

    <!-- Area untuk menampilkan pesan -->
    <div id="messages"></div>

    <script>
        let client;

        // Fungsi untuk connect ke broker MQTT
        function connectMQTT() {
            const brokerUrl = document.getElementById('broker').value;
            client = mqtt.connect(brokerUrl);

            client.on('connect', () => {
                document.getElementById('messages').innerHTML += `<p>Connected to broker ${brokerUrl}</p>`;
            });

            client.on('message', (topic, payload) => {
                document.getElementById('messages').innerHTML += `<p><strong>${topic}:</strong> ${payload.toString()}</p>`;
            });
        }

        // Fungsi untuk publish pesan ke topik MQTT
        function publishMessage() {
            const topic = document.getElementById('topic').value;
            const message = document.getElementById('message').value;

            if (client && topic && message) {
                client.publish(topic, message);
                document.getElementById('messages').innerHTML += `<p>Published: <strong>${message}</strong> to <strong>${topic}</strong></p>`;
            } else {
                alert('Make sure to connect to the broker, and fill in both the topic and message fields.');
            }
        }
    </script>
</body>
</html>
